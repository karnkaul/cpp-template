version: "@PROJECT_VERSION@-{build}"
environment:
  matrix:
    - job_name: Windows x64
      appveyor_build_worker_image: Visual Studio 2019
    - job_name: Linux x64
      appveyor_build_worker_image: Ubuntu
configuration:
  - Release
install:
  - sh: |
      [ "$SKIP_LINUX" == "true" ] && echo "-- Skipping Linux --" && exit
      sudo add-apt-repository ppa:ubuntu-toolchain-r/test
      echo "== Installing dependencies ==" && sudo apt -qq update && sudo apt -qq install -y gcc-10 g++-10
before_build:
  - cmd: cmake . -B out -DCMAKE_INSTALL_PREFIX=./install || exit 1
  - sh: cp cmake/CMakePresets.json .; cmake -S . --preset=nc-release -DCMAKE_INSTALL_PREFIX=./install || exit 1
for:
  - matrix:
      only:
        - job_name: Windows x64
    build:
      project: out/@PROJECT_NAME@.sln
      parallel: true
      verbosity: minimal
  - matrix:
      only:
        - job_name: Linux x64
    build_script:
      - sh: echo "== Building Linux $CONFIGURATION ==" && cmake --build --preset nc-release -v || exit 1
after_build:
  - cmd: cmake --install out
  - sh: cmake --install out/rl
test_script:
  - sh: cd out/rl; ctest || exit 1
  - cmd: |
      cd out
      ctest -C Release || exit 1
matrix:
  fast_finish: true
skip_branch_with_pr: true
